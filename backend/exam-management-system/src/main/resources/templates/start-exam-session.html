<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bắt đầu Ca Thi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.0/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-4">
    <div class="card shadow-sm p-4">
        <h1 class="text-center mb-4">Danh sách sinh viên</h1>
        <form id="startExamSessionForm" method="POST">
            <div class="mb-3">
                <label for="sessionCode" class="form-label">Mã Ca Thi</label>
                <input type="text" class="form-control" id="sessionCode" name="sessionCode" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Bắt đầu</button>
        </form>
        <div id="message" class="mt-3"></div>
        <h4>Kết quả truy vấn</h4>
        <table class="table table-striped">
            <thead class="table-light">
            <tr>
                <th>Họ tên</th>
                <th>MSV</th>
                <th>SĐT</th>
                <th>Ảnh cá nhân</th>
                <th>Trạng thái</th>
                <th>Xác minh</th>
            </tr>
            </thead>
            <tbody id="studentList"></tbody>
        </table>
        <button id="downloadExcelButton" class="btn btn-success w-100 mb-3">Tải xuống danh sách</button>
        <button id="startExamButton" class="btn btn-warning w-100">Tiến hành ca thi</button>
    </div>
</div>

<!-- Script -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $('#startExamSessionForm').submit(function (e) {
            e.preventDefault();

            var sessionCode = $('#sessionCode').val();

            $.ajax({
                url: 'http://127.0.0.1:8000/get-student-info/',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ sessionCode: sessionCode }),
                success: function (response) {
                    if (response.error) {
                        $('#message').removeClass('alert-success').addClass('alert alert-danger').text(response.error);
                        return;
                    }

                    $('#message').removeClass('alert-danger').addClass('alert alert-success').text('Lấy danh sách sinh viên thành công!');
                    $('#studentList').empty();

                    var studentList = response.student_info;

                    studentList.forEach(function (student) {
                        var row = `<tr>
                            <td>${student.name}</td>
                            <td>${student.student_id}</td>
                            <td>${student.phone}</td>
                            <td><img src="${student.image_url}" alt="Ảnh cá nhân" width="50" height="50"></td>
                            <td>${student.status}</td>
                            <td>
                                <a href="/proctor/verify-face?student_id=${student.student_id}&name=${student.name}&phone=${student.phone}&image_url=${student.image_url}"
                                   target="_blank" class="btn btn-info">Xác minh</a>
                            </td>
                        </tr>`;
                        $('#studentList').append(row);
                    });
                },
                error: function (xhr) {
                    $('#message').removeClass('alert-success').addClass('alert alert-danger').text('Có lỗi xảy ra khi lấy thông tin sinh viên.');
                }
            });
        });
    });
</script>
</body>
</html>
